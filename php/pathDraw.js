/*var probs =[ 30.6,16.5,6,5.5,5.3,5.2,5.2,4.8,5.1,5.8,5.2,5,5.2,5.2,4.9,5.8,5.4,4.6,4.8,4.8,4.7,4.4,5.2,6.3,5.8,5.6,5.5,5.6,5.5,6.3,5.6,5,4.8,4.8,5,4.7,5,6.9,6.3,6.3,5.3,5.8,5.6,6.3,11.4,11.4,0,10.5,10.4,10.4,9,36.7,16.7,14.7,14.2,15.6,14.8,13.8,14.8,21.7,17.4,18.9,19.3,19.2,19.1,21.7,16.8,13.2,14.4,13.1,14.2,13.6,13.4,22,18.4,19.3,17.8,19.6,19.1,19.3,23.7,19.9,21,19.3,20.3,22.1,15.8,22.3,18.9,16.7,15.7,19.2,18.3,22.3,30.4,30.4,30.4,30.4,25.3,28.2,30.4,21.5,6.7,5.1,5.4,6.1,5.7,5.9,6.7,11,9.1,9.8,9.4,9.7,9.3,11,9.1,7.7,7.9,8.2,7.8,7.6,9.1,9.9,8.6,7.9,8.1,8.3,8.6,9.9,7,5.6,6.1,5.9,6.1,5.6,7,10.1,8.3,9.3,8.1,8.8,8.3,10.1,10.3,10.3,10.3,8.2,10.3,3.4,10.3,36,11.7,9.9,9.7,10,10,8.9,10.1,17.9,14.3,17,15.4,15.4,14.1,16.5,15.6,12.1,12.3,13.3,12.9,12.3,10.4,23.7,19.7,20.4,19.3,21,20.3,19,21.2,18.1,18.6,16.8,18.4,17.2,17.9,22,16.6,18.9,18,17.2,17.3,15,20.3,14.5,17.4,12.2,16.4,14.2,16.1,44,15.4,13.1,13.3,12.7,13.3,12.7,11.8,23.7,19.1,20.2,20.2,20.2,19,18.6,19.6,15.3,15.9,16.7,16.3,15.4,13.1,29.2,22.2,22.9,22.5,25.7,23.6,25.1,30.1,25.3,25.8,24.2,25.6,28,25.1,29.2,24.5,24.4,26.8,24.9,23.6,24.7,27.8,25.3,22.2,23.2,20.5,25.5,19.6,37.3,10.5,9,8.7,8.8,9.2,8.6,9.3,19.4,15.4,16.1,15,17.5,17,16.6,12.5,9.5,10.2,10,10.7,10.1,10.9,20,15.4,16.2,14.6,17.3,16.6,16.1,25.9,20.2,20.7,19.7,20.2,22.7,21.1,22.7,18.7,18.7,17.8,17.7,19.8,17.5,21,15,21,17.5,19.5,19.4,14,57.5,23.4,18.6,19.5,17.4,20.2,18.5,17.8,35.2,26.9,29.3,29.4,31.9,28.9,25.1,27.4,20.5,23.7,20,23.5,21.8,23.5,36.6,24.9,29.6,25.3,30.3,29,28.1,41.5,32.6,30.7,33.3,31.2,35.1,34.6,39.4,29.2,27.9,29,26,30,39.4,45.1,38.7,45.1,45.1,37.9,41.6,22.6,63.6,34.1,24.3,22.7,30.7,26.2,19.5,23.9,47.1,47.1,47.1,42.4,47.1,40.4,31.4,43.2,21.6,32.4,43.2,36,43.2,43.2,38.2,30.3,26.1,32.7,29.4,28.7,26.6,41,31.1,34.7,30.8,27.2,33.1,41,45.2,37.1,34.6,36.6,34.9,35.5,38.7,46.9,32.8,35.2,39.1,35,38.3,33.2];

*/
var arr = [0,1, 
           11, 110, 110, 110, 110,110, 110,
           12, 120, 120, 120, 120,120, 120,
           13, 130, 130, 130, 130,130, 130,
           14, 140, 140, 140, 140,140, 140,
           15, 150, 150, 150, 150,150, 150,
           16, 160, 160, 160, 160,160, 160,
		   17, 170, 170, 170, 170,170, 170,
		   
        2, 21, 210, 210, 210, 210,210, 210,
           22, 220, 220, 220, 220,220, 220,
           23, 230, 230, 230, 230,230, 230,
           24, 240, 240, 240, 240,240, 240,
           25, 250, 250, 250, 250,250, 250,
           26, 260, 260, 260, 260,260, 260,
           27, 270, 270, 270, 270,270, 270,
           
           
        3, 31, 310, 310, 310, 310,310, 310,
           32, 320, 320, 320, 320,320, 320,
           33, 330, 330, 330, 330,330, 330,
           34, 340, 340, 340, 340,340, 340,
           35, 350, 350, 350, 350,350, 350,
           36, 360, 360, 360, 360,360, 360,
           37, 370, 370, 370, 370,370, 370,
           
           
        4, 41, 410, 410, 410, 410,410, 410,
           42, 420, 420, 420, 420,420, 420,
           43, 430, 430, 430, 430,430, 430,
           44, 440, 440, 440, 440,440, 440,
           45, 450, 450, 450, 450,450, 450,
           46, 460, 460, 460, 460,460, 460,
           47, 470, 470, 470, 470,470, 470,
           
           
        5, 51, 510, 510, 510, 510,510, 510,
           52, 520, 520, 520, 520,520, 520,
           53, 530, 530, 530, 530,530, 530,
           54, 540, 540, 540, 540,540, 540,
           55, 550, 550, 550, 550,550, 550,
           56, 560, 560, 560, 560,560, 560,
           57, 570, 570, 570, 570,570, 570,
           
           
        6, 61, 610, 610, 610, 610,610, 610,
           62, 620, 620, 620, 620,620, 620,
           63, 630, 630, 630, 630,630, 630,
           64, 640, 640, 640, 640,640, 640,
           65, 650, 650, 650, 650,650, 650,
           66, 660, 660, 660, 660,660, 660,
           67, 670, 670, 670, 670,670, 670,
      
        7, 71, 710, 710, 710, 710,710, 710,
           72, 720, 720, 720, 720,720, 720,
           73, 730, 730, 730, 730,730, 730,
           74, 740, 740, 740, 740,740, 740,
           75, 750, 750, 750, 750,750, 750,
           76, 760, 760, 760, 760,760, 760,
           77, 770, 770, 770, 770,770, 770,
           
        8, 81, 810, 810, 810, 810,810, 810,
           82, 820, 820, 820, 820,820, 820,
           83, 830, 830, 830, 830,830, 830,
           84, 840, 840, 840, 840,840, 840,
           85, 850, 850, 850, 850,850, 850,
           86, 860, 860, 860, 860,860, 860,
           87, 870, 870, 870, 870,870, 870
           
          ];
           
var xScale = d3.scale.linear()
    .domain([0, 70])
    .range([6, 0]);

var colorScale = d3.scale.threshold().domain([0,10,20,40, 70]).range(["white","#edeae1","90EE90","orange","red"]);



var diameter = 960;
var tree = d3.layout.tree()
    .size([360, diameter / 2 - 200])
    .separation(function(a, b) {
        return (a.parent == b.parent ? 1 : 2) / a.depth;
    });

var diagonal = d3.svg.diagonal.radial()
    .projection(function(d) {
        return [d.y, d.x / 180 * Math.PI];
    });

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter - 150)
    .append("g")
    .attr("transform", "translate(" + diameter / 2 + "," + (diameter / 2 - 105 )+ ")")
    ;

d3.json("htn-v2.json", function(error, root) {
    if (error) throw error;

    var nodes = tree.nodes(root),
        links = tree.links(nodes);

    var link = svg.selectAll(".link")
        .data(links)
        .enter().append("path")
        .attr("class", "link")
        .attr("d", diagonal)
    .style("stroke", "gray")  //function(d,i) {return colorScale(probs[i]);})
    .style("stroke-opacity", .1)
    ;

    var node = svg.selectAll(".node")
        .data(nodes)
        .enter().append("g")
        .attr("class", "node") //function(d) { return d.name; })
        .attr("transform", function(d) {
            return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")";
            })
    .attr("id","canvas")
    ;

    node.append("circle")
        .attr("r", function(d,i) {return xScale(probs[i])*1.3;})
        .style("fill", function(d,i) {return colorScale(probs[i]);})
        .style({ 'stroke': 'Black', 'stroke-width': '1px'})
  
        .attr("id", function(d) {
            return d.name;
        })
        .attr("class", function(d, i) {
            return arr[i];
        })
    
        //.on('click', function(node) {
        //    if (!node.parent.parent) return 0;
        //    alert(node.parent.parent.name);
        //});

        /* node.append("circle")
        .attr("r", 4)
        .attr("id","circle")
        .style("fill","blue")
        .attr("name",function(d){return d.name;})
        .on("mouseover", function(d) {
         d3.select(this)
                 .attr("r",10)
             })
        .on("mouseleave", function(d) {
                 d3.select(this)
                .attr("r",8)
              })*/

    node.append("text")
        .attr("dy", ".31em")
        .style("font-size", "6px")
        .style("fill","green")
        .attr("text-anchor", function(d) {
            return d.x < 180 ? "start" : "end";
        })
        .attr("transform", function(d) {
            return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)";
        })
        .attr("id", function(d,i) {
            return arr[i]; //d.name;
        })
        .attr("class", function(d, i) {
            return d.name;
        })
        .attr("parent", function(node) {
            if (!node.parent) return 0;
            return node.parent.name;
        })
        .text(function(d,i) {
            return "        " + d.name + " %" + probs[i] + "";
        });
});



//d3.select(self.frameElement).style("height", diameter - 150 + "px");

